#! /bin/sh

set -eux

VER="$(git rev-parse --short HEAD)"
src="$(pwd)"

./rust/target/release/mina-indexer \
  server start \
    --log-dir /mnt/mina-log-storage/"$VER"-logs \
    --log-level DEBUG \
    --log-level-file DEBUG \
    --genesis-ledger "$src"/data/genesis_ledgers/mainnet.json \
    --database-dir /mnt/mina-log-storage/"$VER"-database \
    --blocks-dir /mnt/mina-log-storage/mina_network_block_data \
    --staking-ledgers-dir /mnt/mina-log-storage/mina_network_ledger_data \
    --locked-supply-csv "$src"/data/locked.csv \
    --ledger-cadence 5000
