steps:

- label: "Developer Environment Build and Tier 1 Test"
  key: "build"
  command: "./ops/tier1-test"

- label: "Tier 2 Testing"
  if: build.env('GRANOLA_TIER2') == "true"
  key: "tier2"
  depends_on: "build"
  timeout_in_minutes: 2880
  agents:
    mina-log-storage: true
  command: "./ops/tier2-test"

- label: "Create OCI Image"
  if: build.branch == "main"
  key: image
  depends_on: "build"
  agents:
    docker: true
  command: "./ops/build-oci-image"

- label: "Productionize"
  if: build.branch == "prod"
  key: deploy
  agents:
    mina-log-storage: true
  command: "./ops/productionize"
