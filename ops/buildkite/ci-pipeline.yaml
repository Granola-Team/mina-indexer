# This is not the authoritative pipeline definition. Only Buildkite settings
# allow setting the authoritative config. This file exists to give some
# visibility into the pipeline steps.

steps:

- label: "Developer Environment Build and Tier 1 Test"
  key: "build"
  env:
    NO_COLOR: 1
  command: "nix develop --command just tier1-test"
  agents:
    nix: true
    production: false

# Only a 'main' branch that has succeeded on the above will be deployed.
#
- label: "Deploy to Production"
  if: build.branch == "main"
  key: deploy
  depends_on: "build"
  agents:
    nix: true
    production: true
  env:
    NO_COLOR: 1
  command: "nix develop --command just productionize"
