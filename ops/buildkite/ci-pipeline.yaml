steps:

- label: "Developer Environment Build and Tier 1 Test"
  key: "build"
  command: "./ops/tier1-test"

- label: "Deploy to Production"
  if: build.branch == "main"
  key: deploy
  depends_on: "build"
  agents:
    production: true
  command: |
    nix develop --command just build
    ./ops/productionize

- label: "Create OCI Image"
  if: build.branch == "main"
  key: image
  depends_on: "build"
  agents:
    docker: true
  command: "./ops/build-oci-image"
