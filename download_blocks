#!/bin/sh
set -ex

BLOCKS_DIR="$(mktemp -d 2>/dev/null || mktemp -d -t 'mytmpdir')"
touch "$BLOCKS_DIR"/block_urls

download_blocks_cleanup() {
    rm -fr "$BLOCKS_DIR"
}

trap download_blocks_cleanup EXIT

BUCKET=$1
MIN_LENGTH=$2
MAX_LENGTH=$3
NETWORK=$4
OUT_DIR=$5

for LENGTH in `seq $MIN_LENGTH $MAX_LENGTH`
do
    echo "gs://${BUCKET}/${NETWORK}-${LENGTH}-*.json" >> "$BLOCKS_DIR"/block_urls
done 2>/dev/null

gsutil -m cp -I "$OUT_DIR" < "$BLOCKS_DIR"/block_urls
