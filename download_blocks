#!/bin/sh
set -ex

BLOCKS_DIR="$(mktemp -d 2>/dev/null || mktemp -d -t 'mytmpdir')"
touch "$BLOCKS_DIR"/block_urls

download_blocks_cleanup() {
    rm -fr "$BLOCKS_DIR"
}

trap download_blocks_cleanup EXIT

BUCKET=$1
MAX_SLOT=$2
NETWORK=$3
OUT_DIR=$4

for SLOT in `seq 2 $MAX_SLOT`
do
    echo "gs://${BUCKET}/${NETWORK}-${SLOT}-*.json" >> "$BLOCKS_DIR"/block_urls
done 2>/dev/null

gsutil -m cp -I "$OUT_DIR" < "$BLOCKS_DIR"/block_urls
